<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Play Geolocation Module by edulify</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Play Geolocation Module</h1>
        <p class="header">This is a play module for IP based geolocation</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/edulify/play-geolocation-module.edulify.com/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/edulify/play-geolocation-module.edulify.com/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/edulify/play-geolocation-module.edulify.com">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/edulify">edulify</a></p>


      </header>
      <section>
        <h1>
<a name="play-geolocation-module" class="anchor" href="#play-geolocation-module"><span class="octicon octicon-link"></span></a>play-geolocation-module</h1>

<p>This is a play module for IP based geolocation.</p>

<p>Currently, the module supports use of one of the following service to retrieve the IP data:</p>

<ul>
<li>
<a href="http://freegeoip.net/">Freegeoip</a> - Free web service for retrieve IP data</li>
<li>
<a href="https://www.maxmind.com/en/country">Maxind GeoIP Country Web Service</a> - Web service that retrieve the country of the given IP, with reliability of 99.98%</li>
</ul><h2>
<a name="configuring" class="anchor" href="#configuring"><span class="octicon octicon-link"></span></a>Configuring</h2>

<p>The first step is include the geolocation in your dependencies list, in <code>Build.scala</code> file:</p>

<div class="highlight highlight-scala"><pre><span class="k">import</span> <span class="nn">sbt._</span>
<span class="k">import</span> <span class="nn">Keys._</span>
<span class="k">import</span> <span class="nn">play.Project._</span>

<span class="k">object</span> <span class="nc">ApplicationBuild</span> <span class="k">extends</span> <span class="nc">Build</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">appName</span>         <span class="k">=</span> <span class="s">"geolocation-sample"</span>
  <span class="k">val</span> <span class="n">appVersion</span>      <span class="k">=</span> <span class="s">"1.0-SNAPSHOT"</span>

  <span class="k">val</span> <span class="n">appDependencies</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="c1">// Add your project dependencies here,</span>
    <span class="n">javaCore</span><span class="o">,</span>
    <span class="n">javaJdbc</span><span class="o">,</span>
    <span class="n">javaEbean</span><span class="o">,</span>
    <span class="s">"com.edulify"</span> <span class="o">%</span> <span class="s">"geolocation_2.10"</span> <span class="o">%</span> <span class="s">"1.1.3"</span>
  <span class="o">)</span>

  <span class="k">val</span> <span class="n">main</span> <span class="k">=</span> <span class="n">play</span><span class="o">.</span><span class="nc">Project</span><span class="o">(</span><span class="n">appName</span><span class="o">,</span> <span class="n">appVersion</span><span class="o">,</span> <span class="n">appDependencies</span><span class="o">).</span><span class="n">settings</span><span class="o">(</span>
    <span class="c1">// Add your own project settings here</span>
    <span class="n">resolvers</span> <span class="o">+=</span> <span class="nc">Resolver</span><span class="o">.</span><span class="n">url</span><span class="o">(</span><span class="s">"Edulify Repository"</span><span class="o">,</span> <span class="n">url</span><span class="o">(</span><span class="s">"http://edulify.github.com/modules/releases/"</span><span class="o">))(</span><span class="nc">Resolver</span><span class="o">.</span><span class="n">ivyStylePatterns</span><span class="o">)</span>
  <span class="o">)</span>

<span class="o">}</span>

</pre></div>

<p>Don't forget to add the resolver to your list of resolvers, or it won't work!</p>

<h3>
<a name="configurations" class="anchor" href="#configurations"><span class="octicon octicon-link"></span></a>Configurations</h3>

<p>In order to set the cache configurations, you must use the <code>application.conf</code> file, using the following keys:</p>

<pre><code>geolocation {
  useCache  = true                             # use cache (true | false)
  cacheTTL  = 3600                             # time in seconds that cache will be kept
  source    = FREEGEOIP                        # the web service that should be used for
                                               # your IP queries (FREEGEOIP | GEOIP_COUNTRY)
  # maxmind_license = yourMaxmindLicenseCode   # used only when the source is GEOIP_COUNTRY
}
</code></pre>

<p>You can also set the key <code>geolocation.debug</code> with a boolean value (true | false) in order to enable / disable the debug of requests. This debug will use the method <code>play.Logger.debug</code> to show in the <em>Play terminal</em> the requests made to the service and their responses.</p>

<h3>
<a name="caching" class="anchor" href="#caching"><span class="octicon octicon-link"></span></a>Caching</h3>

<p>This module saves a cache of the data for the requested IPs. The default cache time to live is 3600 seconds (1 hour), but this time can be setted through the <code>conf</code> file, as shown above.</p>

<p>Also, you can set cache off, also through the <code>conf</code> file. <strong>Warning</strong>: by setting off the cache, you can overload your system (and the service) due to multiple requests. Also, if you are using the Maxmind GeoIP service, cache off can waste your request quota. Without cache activated, every call to <code>GeolocationService.getGeolocate</code> will necessarily make a request to the choosen web service.</p>

<h2>
<a name="using" class="anchor" href="#using"><span class="octicon octicon-link"></span></a>Using</h2>

<p>To use this module, its enough to import it in your class and use the static method <code>GeolocationService.getGeolocation</code>. This call will return an object of the class <code>Geolocation</code>, and can throw the following Exceptions:</p>

<ul>
<li>
<code>InvalidAddressException</code> - when the argument address is not valid.</li>
<li>
<code>ServiceErrorException</code> - when the Web service response is not recognized.</li>
</ul><p>The <code>Geolocation</code> class has the following methods:</p>

<h5>
<a name="string-getip" class="anchor" href="#string-getip"><span class="octicon octicon-link"></span></a><em>String</em> getIp()</h5>

<p>Returns the ip returned by the web service.</p>

<h5>
<a name="string-getcountrycode" class="anchor" href="#string-getcountrycode"><span class="octicon octicon-link"></span></a><em>String</em> getCountryCode()</h5>

<p>Returns the country code (with two letters) returned by the web service.</p>

<h5>
<a name="string-getcountryname" class="anchor" href="#string-getcountryname"><span class="octicon octicon-link"></span></a><em>String</em> getCountryName()</h5>

<p>Returns the country name returned by the web service.</p>

<h5>
<a name="string-getregioncode" class="anchor" href="#string-getregioncode"><span class="octicon octicon-link"></span></a><em>String</em> getRegionCode()</h5>

<p>Returns the region code returned by the web service.</p>

<h5>
<a name="string-getregionname" class="anchor" href="#string-getregionname"><span class="octicon octicon-link"></span></a><em>String</em> getRegionName()</h5>

<p>Returns the region name returned by the web service.</p>

<h5>
<a name="string-getcity" class="anchor" href="#string-getcity"><span class="octicon octicon-link"></span></a><em>String</em> getCity()</h5>

<p>Returns the city returned by the web service.</p>

<h5>
<a name="double-getlatitude" class="anchor" href="#double-getlatitude"><span class="octicon octicon-link"></span></a><em>double</em> getLatitude()</h5>

<p>Returns the latitude returned by the web service.</p>

<h5>
<a name="double-getlongitude" class="anchor" href="#double-getlongitude"><span class="octicon octicon-link"></span></a><em>double</em> getLongitude()</h5>

<p>Returns the longitude returned by the web service.</p>

<hr><p>Note that all methods but <code>getIp()</code> and <code>getCountryCode()</code> will return <code>null</code> or <code>0</code> value when the source is <em>GEOIP_COUNTRY</em>.</p>

<p>Example code:</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">com.edulify.modules.geolocation.Geolocation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.edulify.modules.geolocation.GeolocationService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.edulify.modules.geolocation.InvalidAddressException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Geolocation</span> <span class="n">geolocation</span> <span class="o">=</span> <span class="n">GeolocationService</span><span class="o">.</span><span class="na">getGeolocation</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">remoteAddress</span><span class="o">());</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">geolocation</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// the service does not responded properly</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">if</span> <span class="o">(</span><span class="s">"US"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">geolocation</span><span class="o">.</span><span class="na">getCountryCode</span><span class="o">()))</span> <span class="o">{</span>
        <span class="o">...</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InvalidAddressException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
